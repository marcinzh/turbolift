<!DOCTYPE html><html><head><title>Turbolift: Higher Order Effects</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="marcinzh" /><meta name="description" content="Algebraic Effects for Scala 3" /><meta name="og:image" content="/turbolift/img/poster.png" /><meta name="image" property="og:image" content="/turbolift/img/poster.png" /><meta name="og:title" content="Turbolift: Higher Order Effects" /><meta name="title" property="og:title" content="Turbolift: Higher Order Effects" /><meta name="og:site_name" content="Turbolift" /><meta name="og:url" content="https://github.com/marcinzh/turbolift" /><meta name="og:type" content="website" /><meta name="og:description" content="Algebraic Effects for Scala 3" /><link rel="icon" type="image/png" href="/turbolift/img/favicon.png" /><meta name="twitter:title" content="Turbolift: Higher Order Effects" /><meta name="twitter:image" content="https://marcinzh.github.io/turbolift/img/poster.png" /><meta name="twitter:description" content="Algebraic Effects for Scala 3" /><meta name="twitter:card" content="summary_large_image" /><link rel="icon" type="image/png" sizes="16x16" href="/turbolift/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/turbolift/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/turbolift/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/turbolift/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/turbolift/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/turbolift/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/turbolift/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/turbolift/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/turbolift/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/turbolift/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/turbolift/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/turbolift/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/turbolift/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/turbolift/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/turbolift/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/turbolift/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/turbolift/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/turbolift/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/turbolift/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/turbolift/img/favicon310x150.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/turbolift/highlight/styles/atom-one-light.css" /><link rel="stylesheet" href="/turbolift/css/pattern-style.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><ul id="sidebar" class="sidebar-nav"><li class="sidebar-brand"><a href="/turbolift/" class="brand"><div class="brand-wrapper"><span>Turbolift</span></div></a></li> <li><a href="/turbolift/overview.html" class="">Overview</a></li> <li><a href="/turbolift/custom/index.html" class="">Defining your own effects and handlers</a> <ul class="sub-section"> <li><a href="/turbolift/custom/flip.html" class="">Effect example: Flip </a></li> <li><a href="/turbolift/custom/file_sys.html" class="">Effect example: File System</a></li></ul></li> <li><a href="/turbolift/advanced/index.html" class="">Advanced Features</a> <ul class="sub-section"> <li><a href="/turbolift/advanced/labelled.html" class="">Labelled Effects</a></li> <li><a href="/turbolift/advanced/applicative.html" class="">Applicative Effects</a></li> <li><a href="/turbolift/advanced/higher.html" class=" active ">Higher Order Effects</a></li></ul></li> <li><a href="/turbolift/io.html" class="">IO</a></li></ul></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li class="search-nav hidden-xs hidden-sm"><div id="search-dropdown"><label><i class="fa fa-search"></i>Search</label><input id="search-bar" type="text" placeholder="Enter keywords here..." onclick="displayToggleSearch(event)" /><ul id="search-dropdown-content" class="dropdown dropdown-content"></ul></div></li><li id="gh-eyes-item" class="hidden-xs to-uppercase"><a href="https://github.com/marcinzh/turbolift" target="_blank" rel="noopener noreferrer"><i class="fa fa-eye"></i><span>Watchers<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs to-uppercase"><a href="https://github.com/marcinzh/turbolift" target="_blank" rel="noopener noreferrer"><i class="fa fa-star-o"></i><span>Stars<span id="stars" class="label label-default">--</span></span></a></li></ul></div></div></div></div><div id="content" data-github-owner="marcinzh" data-github-repo="turbolift"><div class="content-wrapper"><section><h1 id="higher-order-effects">Higher Order Effects</h1>

<p>a.k.a Scoped Effects.</p>

<h3 id="hoes-are-problematic">HOEs are problematic</h3>

<ul>
  <li>New programming languages with native Algebraic Effects, generally don‚Äôt support HOEs. Exceptions are:
    <ul>
      <li><a href="https://github.com/frank-lang/frank">Frank</a> language.</li>
      <li><a href="https://www.unison-lang.org/">Unison</a> language, which implements Frank‚Äôs effect system.</li>
    </ul>
  </li>
  <li>
    <p>According to the underlying theory, HOEs are actually <a href="https://old.reddit.com/r/haskell/comments/ej8fme/unordered_effects/fd00mk2/?context=3">non-algebraic</a> ‚ö†Ô∏è<strong>Œª</strong><sup id="fnref:1" role="doc-noteref"><a href="#fn:1" class="footnote" rel="footnote">1</a></sup>.</p>
  </li>
  <li>
    <p>The Eff Monad doesn‚Äôt support HOEs.</p>
  </li>
  <li>Monad Transformers do support HOEs. However, there are some known problems. Such as effect‚Äôs semantics being dependent
on the order of monad transformers in the stack. More info on the subject:
    <ul>
      <li><a href="https://old.reddit.com/r/haskell/comments/pywuqg/unresolved_challenges_of_scoped_effects_and_what/">Unresolved challenges of scoped effects</a> ‚ö†Ô∏è<strong>Œª</strong><sup id="fnref:1:1" role="doc-noteref"><a href="#fn:1" class="footnote" rel="footnote">1</a></sup> video.</li>
      <li><a href="https://github.com/lexi-lambda/eff/blob/master/notes/semantics-zoo.md">Effect Semantics Zoo</a> ‚ö†Ô∏è<strong>Œª</strong><sup id="fnref:1:2" role="doc-noteref"><a href="#fn:1" class="footnote" rel="footnote">1</a></sup></li>
    </ul>
  </li>
</ul>

<h3 id="hoes-in-turbolift">HOEs in Turbolift</h3>

<p>In this example, we run the given program twice, with 2 orderings of handlers:</p>
<ol>
  <li><code class="language-plaintext highlighter-rouge">Error</code> handled before <code class="language-plaintext highlighter-rouge">State</code>.</li>
  <li><code class="language-plaintext highlighter-rouge">State</code> handled before <code class="language-plaintext highlighter-rouge">Error</code>.</li>
</ol>

<p>We observe consistent behavior: in both cases,
raising the error didn‚Äôt cause the <code class="language-plaintext highlighter-rouge">State</code> to reset to it‚Äôs value from
before the <code class="language-plaintext highlighter-rouge">catchAll</code> operation.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">turbolift.</span><span class="o">!!</span>
<span class="k">import</span> <span class="nn">turbolift.effects.</span><span class="o">{</span><span class="nc">Error</span><span class="o">,</span> <span class="nc">State</span><span class="o">}</span>

<span class="k">case</span> <span class="k">object</span> <span class="nc">MyError</span> <span class="k">extends</span> <span class="nc">Error</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span>
<span class="k">case</span> <span class="k">object</span> <span class="nc">MyState</span> <span class="k">extends</span> <span class="nc">State</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span>

<span class="k">val</span> <span class="nv">program</span> <span class="k">=</span>
  <span class="nv">MyError</span><span class="o">.</span><span class="py">catchAll</span> <span class="o">{</span>
    <span class="nv">MyState</span><span class="o">.</span><span class="py">put</span><span class="o">(</span><span class="mi">42</span><span class="o">)</span> <span class="o">&amp;&amp;!</span>
    <span class="nv">MyError</span><span class="o">.</span><span class="py">raise</span><span class="o">(</span><span class="s">"error"</span><span class="o">)</span>
  <span class="o">}</span> <span class="o">{</span>
    <span class="k">case</span> <span class="k">_</span> <span class="k">=&gt;</span> <span class="o">!!.</span><span class="py">pure</span><span class="o">(</span><span class="s">"nvm"</span><span class="o">)</span>
  <span class="o">}</span>
<span class="c1">// program: Computation[String, MyState &amp; MyError] = turbolift.Computation@6bb73a26</span>

<span class="k">val</span> <span class="nv">result1</span> <span class="k">=</span> <span class="n">program</span>
  <span class="o">.</span><span class="py">handleWith</span><span class="o">(</span><span class="nv">MyError</span><span class="o">.</span><span class="py">handler</span><span class="o">)</span>
  <span class="o">.</span><span class="py">handleWith</span><span class="o">(</span><span class="nv">MyState</span><span class="o">.</span><span class="py">handler</span><span class="o">(</span><span class="mi">0</span><span class="o">))</span>
  <span class="o">.</span><span class="py">run</span>
<span class="c1">// result1: Tuple2[Either[String, String], Int] = (Right(value = "nvm"), 42)</span>

<span class="k">val</span> <span class="nv">result2</span> <span class="k">=</span> <span class="n">program</span>
  <span class="o">.</span><span class="py">handleWith</span><span class="o">(</span><span class="nv">MyState</span><span class="o">.</span><span class="py">handler</span><span class="o">(</span><span class="mi">0</span><span class="o">))</span>
  <span class="o">.</span><span class="py">handleWith</span><span class="o">(</span><span class="nv">MyError</span><span class="o">.</span><span class="py">handler</span><span class="o">)</span>
  <span class="o">.</span><span class="py">run</span>
<span class="c1">// result2: Either[String, Tuple2[String, Int]] = Right(value = ("nvm", 42))</span>
</code></pre></div></div>

<h3 id="-bonus-feature">üéÅ Bonus feature</h3>

<p>The implementation of HOEs in Turbolift has an accidental consequence.
It‚Äôs possible to write an alternative handler for the <code class="language-plaintext highlighter-rouge">Error</code> effect,
so that it replicates behavior of Monad Transformers.
With such handler, state is transactional, when handled before error.</p>

<hr />

<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:1" role="doc-endnote">
      <p><strong>Warning:</strong> Haskell code ahead.¬†<a href="#fnref:1" class="reversefootnote" role="doc-backlink">&#8617;</a>¬†<a href="#fnref:1:1" class="reversefootnote" role="doc-backlink">&#8617;<sup>2</sup></a>¬†<a href="#fnref:1:2" class="reversefootnote" role="doc-backlink">&#8617;<sup>3</sup></a></p>
    </li>
  </ol>
</div>
</section></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/turbolift/highlight/highlight.pack.js"></script><script src="/turbolift/lunr/lunr.js"></script><script>
// For all code blocks, copy the language from the containing div
// to the inner code tag (where hljs expects it to be)
const langPrefix = 'language-';
document.querySelectorAll(`div[class^='${langPrefix}']`).forEach(function(div) {
  div.classList.forEach(function(cssClass) {
    if (cssClass.startsWith(langPrefix)) {
      const lang = cssClass.substring(langPrefix.length);
      div.querySelectorAll('pre code').forEach(function(code) {
        code.classList.add(lang);
      });
    }
  });
});

hljs.configure({languages:['scala','java','bash']});
hljs.initHighlightingOnLoad();
      </script><script>console.info('\x57\x65\x62\x73\x69\x74\x65\x20\x62\x75\x69\x6c\x74\x20\x77\x69\x74\x68\x3a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x5f\x5f\x0a\x20\x20\x20\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x5f\x20\x20\x2f\x20\x2f\x5f\x20\x20\x20\x20\x20\x20\x5f\x5f\x5f\x5f\x20\x5f\x5f\x5f\x20\x20\x28\x5f\x29\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x28\x5f\x29\x20\x2f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x0a\x20\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x60\x5f\x5f\x20\x5c\x2f\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x20\x2f\x20\x5f\x5f\x2f\x20\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x0a\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x5f\x2f\x20\x2f\x20\x2f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x5f\x5f\x2f\x20\x2f\x20\x20\x2f\x20\x2f\x5f\x2f\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x20\x2f\x5f\x2f\x20\x20\x5f\x5f\x28\x5f\x5f\x20\x20\x29\x0a\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2e\x5f\x5f\x5f\x2f\x5c\x5f\x5f\x2f\x20\x20\x20\x20\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x2f\x20\x20\x20\x5c\x5f\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x0a\x0a\x68\x74\x74\x70\x73\x3a\x2f\x2f\x34\x37\x64\x65\x67\x2e\x67\x69\x74\x68\x75\x62\x2e\x69\x6f\x2f\x73\x62\x74\x2d\x6d\x69\x63\x72\x6f\x73\x69\x74\x65\x73')</script><script src="/turbolift/js/search.js"></script><script src="/turbolift/js/main.js"></script></body></html>